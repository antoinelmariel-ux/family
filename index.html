<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Éditeur de Procédures IA Friendly</title>
  <style>
    :root {
      color-scheme: light;
      --primary: #2f4f9f;
      --accent: #f8f9ff;
      --border: #dce0f3;
      --text: #1c2240;
      --muted: #5c6280;
      --warning: #d64545;
      --success: #20895e;
      --bg: #f4f6fb;
    }

    * {
      box-sizing: border-box;
    }

    [hidden] {
      display: none !important;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', 'Inter', 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
    }

    header {
      background: white;
      padding: 24px 32px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 16px;
    }

    header h1 {
      margin: 0;
      font-size: 24px;
    }

    .header-brand {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .header-logo {
      height: 48px;
      width: auto;
    }

    .header-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 1.25em;
      height: 1.25em;
      color: var(--primary);
    }

    .icon svg {
      width: 100%;
      height: 100%;
      fill: none;
      stroke: currentColor;
      stroke-width: 1.8;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    .icon svg .icon-accent {
      fill: currentColor;
      opacity: 0.14;
      stroke: none;
    }

    .icon svg .icon-dot {
      fill: currentColor;
      stroke: none;
    }

    .icon--import {
      color: #2563eb;
    }

    .icon--backoffice {
      color: #6366f1;
    }

    .icon--new {
      color: #16a34a;
    }

    .icon--info {
      color: #0ea5e9;
    }

    .icon--metadata {
      color: #f97316;
    }

    .icon--editor {
      color: #f43f5e;
    }

    .icon--qa {
      color: #3b82f6;
    }

    .icon--export {
      color: #0ea5e9;
    }

    .icon--preview {
      color: #8b5cf6;
    }

    .icon--markdown {
      color: #14b8a6;
    }

    .icon--pdf {
      color: #ef4444;
    }

    .icon--guidelines {
      color: #f59e0b;
    }

    .icon--glossary {
      color: #6366f1;
    }

    .icon--config {
      color: #10b981;
    }

    .language-selector {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .language-select {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: #fff;
      font-size: 14px;
      color: var(--text);
      cursor: pointer;
    }

    .new-procedure-btn {
      padding: 10px 18px;
      border-radius: 10px;
      border: none;
      background: var(--primary);
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(47, 79, 159, 0.2);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      display: inline-flex;
      align-items: center;
      gap: 10px;
    }

    .new-procedure-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(47, 79, 159, 0.25);
    }

    .info-card {
      background: var(--accent);
      border: 1px dashed var(--primary);
      color: var(--text);
    }

    .info-card p {
      margin: 0;
      color: var(--muted);
      line-height: 1.5;
    }

    .info-card ul {
      margin: 12px 0 0;
      padding-left: 20px;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.5;
    }

    .layout {
      display: flex;
      flex-direction: column;
      gap: 24px;
      padding: 24px 32px 64px;
    }

    .editor-insights {
      display: grid;
      grid-template-columns: minmax(0, 1fr) 340px;
      gap: 24px;
      align-items: flex-start;
    }

    .card {
      background: white;
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 8px 24px rgba(28, 34, 64, 0.08);
      border: 1px solid var(--border);
      margin-bottom:10px;
    }

    .card h2 {
      margin-top: 0;
      font-size: 20px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .card h3 {
      margin-top: 24px;
      font-size: 18px;
    }

    label {
      display: block;
      font-weight: 600;
      margin-bottom: 8px;
    }

    input[type="text"],
    textarea,
    select,
    input[type="date"] {
      width: 100%;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: #fff;
      font-size: 14px;
      font-family: inherit;
      transition: border 0.2s, box-shadow 0.2s;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    input:focus,
    textarea:focus,
    select:focus,
    .editor:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(47, 79, 159, 0.15);
    }

    .metadata-grid {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .metadata-group {
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 20px;
      background: #f9faff;
      display: flex;
      flex-direction: column;
      gap: 16px;
      box-shadow: inset 0 0 0 1px rgba(47, 79, 159, 0.05);
    }

    .metadata-group-header h3 {
      margin: 0;
      font-size: 17px;
    }

    .metadata-group-header p {
      margin: 4px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.45;
    }

    .metadata-group-fields {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 16px 20px;
    }

    .field-hint {
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.4;
    }

    .keyword-input-wrapper {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .keyword-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .keyword-tag {
      display: inline-flex;
      align-items: center;
      padding: 6px 10px 6px 12px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 600;
      border: 1px solid transparent;
      background: var(--accent);
      color: var(--primary);
      gap: 8px;
    }

    .keyword-remove {
      appearance: none;
      border: none;
      background: transparent;
      color: inherit;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      padding: 0;
      line-height: 1;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .keyword-remove:focus {
      outline: none;
      text-decoration: underline;
    }

    .keyword-empty {
      font-size: 13px;
      color: var(--muted);
    }

    .backoffice-card {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .backoffice-description {
      margin: 0;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.5;
    }

    .backoffice-section {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 18px;
      background: #f7f8ff;
      display: flex;
      flex-direction: column;
      gap: 14px;
      box-shadow: inset 0 0 0 1px rgba(47, 79, 159, 0.08);
    }

    .backoffice-section-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 12px;
      flex-wrap: wrap;
    }

    .backoffice-section-header h3 {
      margin: 0;
      font-size: 16px;
    }

    .backoffice-section-info {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      width: 100%;
    }

    .backoffice-section-info h3 {
      flex: 1 1 auto;
      min-width: 160px;
    }

    .backoffice-field-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      justify-content: flex-end;
      margin-left: auto;
      max-width: 100%;
    }

    .backoffice-field-chip {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(47, 79, 159, 0.12);
      color: var(--primary);
      font-size: 12px;
      font-weight: 600;
    }

    .backoffice-template-section {
      background: #fff;
    }

    .backoffice-template-description {
      margin: 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
    }

    .backoffice-template-language {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .backoffice-template-language select {
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: #fff;
      font-size: 13px;
      color: var(--text);
      max-width: 220px;
    }

    .backoffice-template-input {
      min-height: 200px;
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid var(--border);
      font-family: inherit;
      font-size: 13px;
      line-height: 1.5;
      resize: vertical;
      background: #fff;
    }

    .backoffice-template-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .backoffice-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      align-items: center;
    }

    .backoffice-controls input[type="text"] {
      flex: 1 1 240px;
      min-width: 200px;
    }

    .backoffice-add-btn {
      padding: 8px 14px;
      border-radius: 8px;
      border: none;
      background: var(--primary);
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      font-size: 13px;
      box-shadow: 0 2px 6px rgba(47, 79, 159, 0.25);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .backoffice-add-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 10px rgba(47, 79, 159, 0.25);
    }

    .backoffice-reset-btn {
      padding: 8px 14px;
      border-radius: 8px;
      border: 1px solid var(--border);
      background: #fff;
      color: var(--text);
      font-weight: 600;
      cursor: pointer;
      font-size: 13px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .option-list {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .option-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: var(--accent);
      color: var(--primary);
      border: 1px solid rgba(47, 79, 159, 0.25);
      font-size: 13px;
      font-weight: 600;
    }

    .option-pill-remove {
      appearance: none;
      border: none;
      background: none;
      color: var(--warning);
      font-weight: 700;
      cursor: pointer;
      padding: 0;
      line-height: 1;
      font-size: 14px;
    }

    .option-pill-remove:focus {
      outline: none;
      text-decoration: underline;
    }

    .option-empty {
      font-size: 13px;
      color: var(--muted);
    }

    .editor-card {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .editor-layout {
      display: grid;
      gap: 24px;
      grid-template-columns: minmax(0, 1fr);
    }

    .editor-pane {
      min-width: 0;
      position: relative;
    }

    .editor-guideline-layer {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 3;
    }

    .guideline-marker {
      position: absolute;
      left: 12px;
      transform: translateY(-50%);
      background: #DDE7EE;
      color: #fff;
      border-radius: 999px;
      padding: 4px 12px;
      font-size: 12px;
      font-weight: 600;
      box-shadow: 0 6px 12px rgba(28, 34, 64, 0.18);
      pointer-events: auto;
      border: none;
      cursor: pointer;
      transition: background 0.2s ease, transform 0.2s ease;
    }

    .guideline-marker:hover,
    .guideline-marker:focus-visible {
      background: #1c2240;
      outline: none;
      transform: translateY(-50%) scale(1.04);
    }

    .guideline-marker.is-active {
      background: var(--accent);
      color: var(--primary);
      box-shadow: 0 0 0 2px rgba(47, 79, 159, 0.35);
    }

    .guideline-marker.is-hidden {
      opacity: 0.5;
      box-shadow: 0 4px 8px rgba(28, 34, 64, 0.12);
    }

    @media (min-width: 1024px) {
      .editor-layout {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    .toolbar button {
      padding: 8px 12px;
      border: 1px solid var(--border);
      background: var(--accent);
      color: var(--text);
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 13px;
      transition: transform 0.15s, box-shadow 0.15s;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .toolbar button:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(28, 34, 64, 0.12);
    }

    .rational-block {
      border: 1px dashed var(--primary);
      background: rgba(47, 79, 159, 0.08);
      border-radius: 12px;
      padding: 16px 18px;
      margin: 20px 0;
    }

    .rational-block-title {
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      font-size: 12px;
      margin: 0 0 12px;
      color: var(--primary);
    }

    .rational-block[data-block-type="rationnel"] p {
      margin: 0;
    }

    .editor {
      min-height: 320px;
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px 60px;
      line-height: 1.6;
      font-size: 15px;
      background: #fff;
      overflow-y: auto;
    }

    .inline-guidelines {
      display: flex;
      flex-direction: column;
      gap: 12px;
      border-radius: 16px;
      padding: 16px;
      background: #fff;
      box-shadow: inset 0 0 0 1px var(--border);
    }

    .inline-guidelines h3 {
      margin: 0;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .inline-guidelines p {
      margin: 0;
      color: var(--muted);
      font-size: 13px;
    }

    .editor h1,
    .editor h2,
    .editor h3,
    .editor h4 {
      font-weight: 700;
      margin-top: 24px;
    }

    .editor ul,
    .editor ol {
      padding-left: 24px;
    }

    .qa-item {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      background: #fafbff;
    }

    .qa-actions {
      display: flex;
      justify-content: flex-end;
    }

    .remove-btn {
      background: none;
      border: none;
      color: var(--warning);
      font-weight: 600;
      cursor: pointer;
    }

    .insights {
      display: flex;
      flex-direction: column;
      gap: 16px;
      position: sticky;
      top: 120px;
      max-height: calc(100vh - 140px);
      overflow-y: auto;
    }

    .insight-tabs {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .insight-tab-list {
      display: flex;
      gap: 8px;
      padding: 4px;
      border-radius: 12px;
      background: #fff;
      box-shadow: inset 0 0 0 1px var(--border);
    }

    .insight-tab-btn {
      flex: 1;
      border: none;
      background: transparent;
      padding: 10px 14px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      color: var(--muted);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s ease, color 0.2s ease, box-shadow 0.2s ease;
    }

    .insight-tab-btn:hover {
      background: rgba(47, 79, 159, 0.08);
      color: var(--text);
    }

    .insight-tab-btn.is-active {
      background: var(--primary);
      color: #fff;
      box-shadow: 0 4px 12px rgba(47, 79, 159, 0.2);
    }

    .insight-tab-btn.is-active:hover {
      background: var(--primary);
    }

    .insight-tab-btn:focus-visible {
      outline: none;
      box-shadow: 0 0 0 3px rgba(47, 79, 159, 0.3);
    }

    .insight-tab-panel {
      display: block;
    }

    .insight-card {
      border-left: 4px solid var(--primary);
      padding: 16px;
      border-radius: 12px;
      background: #fff;
      box-shadow: inset 0 0 0 1px var(--border);
    }

    .insight-card h3 {
      margin: 0 0 8px;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .insight-list {
      margin: 0;
      padding-left: 18px;
      color: var(--muted);
      font-size: 14px;
    }

    .guideline-comment-list {
      list-style: none;
      padding-left: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .guideline-entry {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 12px;
      background: rgba(28, 34, 64, 0.04);
      border: 1px solid rgba(28, 34, 64, 0.08);
    }

    .guideline-entry.is-active {
      background: rgba(47, 79, 159, 0.12);
      border-color: rgba(47, 79, 159, 0.35);
    }

    .guideline-entry.is-hidden {
      opacity: 0.6;
      border-style: dashed;
    }

    .guideline-entry-header {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .guideline-line-text {
      flex: 1;
      font-size: 13px;
      color: var(--text);
      min-width: 0;
    }

    .guideline-comment-toggle {
      min-width: 28px;
      height: 28px;
      border-radius: 999px;
      border: none;
      background: var(--primary);
      color: white;
      font-weight: 700;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s ease, transform 0.2s ease;
      padding: 0 10px;
    }

    .guideline-comment-toggle:hover,
    .guideline-comment-toggle:focus-visible {
      background: #1c2240;
      transform: scale(1.05);
    }

    .guideline-comment-toggle:focus-visible {
      outline: none;
      box-shadow: 0 0 0 3px rgba(47, 79, 159, 0.25);
    }

    .guideline-comment-toggle[aria-expanded="true"] {
      background: var(--accent);
      color: var(--primary);
    }

    .guideline-hide-btn {
      border: none;
      background: none;
      color: var(--muted);
      font-size: 12px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 6px;
      border-radius: 6px;
      transition: color 0.2s ease, background 0.2s ease;
    }

    .guideline-hide-btn:hover,
    .guideline-hide-btn:focus-visible {
      color: var(--primary);
      background: rgba(47, 79, 159, 0.12);
      outline: none;
    }

    .guideline-hidden-toggle {
      border: none;
      background: rgba(28, 34, 64, 0.08);
      color: var(--text);
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 999px;
      cursor: pointer;
      transition: background 0.2s ease, color 0.2s ease;
      margin: 0 0 12px;
      align-self: flex-start;
    }

    .guideline-hidden-toggle:hover,
    .guideline-hidden-toggle:focus-visible {
      background: rgba(47, 79, 159, 0.15);
      color: var(--primary);
      outline: none;
    }

    .guideline-comment-panel {
      background: white;
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 13px;
      line-height: 1.5;
      color: var(--text);
      box-shadow: inset 0 0 0 1px rgba(28, 34, 64, 0.08);
    }

    .comment-line {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 4px 8px;
      border-radius: 999px;
      background: rgba(28, 34, 64, 0.08);
      color: var(--muted);
      font-weight: 600;
      font-size: 12px;
      border: 1px solid rgba(28, 34, 64, 0.12);
      white-space: nowrap;
    }

    .export-actions {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      margin-top: 24px;
    }

    .primary-btn,
    .secondary-btn {
      padding: 12px 18px;
      font-size: 15px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .primary-btn {
      background: var(--primary);
      color: white;
    }

    .primary-btn:disabled {
      background: #b0b7d6;
      cursor: not-allowed;
    }

    .secondary-btn {
      background: white;
      color: var(--primary);
      border: 1px solid var(--primary);
    }

    .ghost-btn {
      padding: 10px 16px;
      font-size: 15px;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      border: 1px dashed rgba(47, 79, 159, 0.6);
      background: transparent;
      color: var(--primary);
      transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .ghost-btn:hover,
    .ghost-btn:focus-visible {
      background: rgba(47, 79, 159, 0.08);
      border-color: rgba(47, 79, 159, 0.85);
      outline: none;
    }

    .warning {
      color: var(--warning);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
    }

    .backoffice-overlay {
      position: fixed;
      inset: 0;
      background: rgba(10, 14, 35, 0.55);
      display: none;
      align-items: flex-start;
      justify-content: center;
      padding: 48px 24px;
      z-index: 20;
      overflow-y: auto;
    }

    .backoffice-overlay.open {
      display: flex;
    }

    .glossary-overlay {
      position: fixed;
      inset: 0;
      background: rgba(10, 14, 35, 0.55);
      display: none;
      align-items: flex-start;
      justify-content: center;
      padding: 48px 24px;
      z-index: 18;
      overflow-y: auto;
    }

    .glossary-overlay.open {
      display: flex;
    }

    .glossary-panel {
      background: #fff;
      border-radius: 18px;
      max-width: 680px;
      width: 100%;
      box-shadow: 0 18px 48px rgba(14, 24, 56, 0.28);
      padding: 32px;
      display: flex;
      flex-direction: column;
      gap: 20px;
      outline: none;
    }

    .glossary-panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    .glossary-panel-header h2 {
      margin: 0;
      font-size: 22px;
    }

    .glossary-description {
      margin: 0;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.5;
    }

    .glossary-list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .glossary-list li {
      padding: 12px 14px;
      border-radius: 12px;
      background: rgba(28, 34, 64, 0.04);
      border: 1px solid rgba(28, 34, 64, 0.08);
    }

    .glossary-list li p {
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.5;
    }

    .backoffice-panel {
      background: #fff;
      border-radius: 18px;
      max-width: 960px;
      width: 100%;
      box-shadow: 0 18px 48px rgba(14, 24, 56, 0.28);
      padding: 32px;
      display: flex;
      flex-direction: column;
      gap: 24px;
      outline: none;
    }

    .backoffice-panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
    }

    .backoffice-panel-header h2 {
      margin: 0;
      font-size: 22px;
    }

    .backoffice-actions {
      justify-content: flex-end;
    }

    .preview-modal {
      position: fixed;
      inset: 0;
      background: rgba(10, 14, 35, 0.55);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 32px;
      z-index: 10;
    }

    .preview-content {
      background: white;
      border-radius: 16px;
      max-width: 960px;
      width: 100%;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
      box-shadow: 0 12px 36px rgba(14, 24, 56, 0.32);
    }

    .preview-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .preview-body {
      padding: 24px;
      overflow-y: auto;
      background: #f9f9ff;
    }

    pre {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      overflow-x: auto;
      white-space: pre-wrap;
      word-wrap: break-word;
      font-size: 13px;
    }

    footer {
      background: white;
      border-top: 1px solid var(--border);
      padding: 16px 32px;
      text-align: right;
      font-size: 13px;
      color: var(--muted);
    }

    @media (max-width: 1100px) {
      .editor-insights {
        grid-template-columns: 1fr;
      }

      .insights {
        position: static;
        max-height: none;
      }

      .backoffice-panel {
        max-width: 720px;
        padding: 28px;
      }

      .glossary-panel {
        max-width: 560px;
        padding: 28px;
      }
    }

    @media (max-width: 600px) {
      header {
        padding: 20px;
        justify-content: flex-start;
      }

      .header-brand {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }

      .header-logo {
        height: 40px;
      }

      .header-actions {
        width: 100%;
        justify-content: flex-start;
      }

      .new-procedure-btn {
        width: 100%;
      }

      .ghost-btn {
        width: 100%;
      }

      .backoffice-overlay {
        padding: 32px 16px;
      }

      .backoffice-panel {
        padding: 24px;
        border-radius: 16px;
      }

      .backoffice-panel-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .backoffice-panel-header h2 {
        font-size: 20px;
      }

      .backoffice-actions {
        width: 100%;
        justify-content: stretch;
      }

      .backoffice-actions .secondary-btn {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="header-brand">
        <img
          src="./assets/images/lfb-ethical-commitment-quadri.jpg"
          alt="Charte éthique LFB"
          class="header-logo"
        />
        <h1 id="header-title">Studio de Procédures IA Friendly</h1>
      </div>
      <div class="header-actions">
        <div class="language-selector">
          <select id="language-select" class="language-select" aria-label="Langue de l'interface">
            <option value="fr">FR</option>
            <option value="en">EN</option>
            <option value="es">ES</option>
          </select>
        </div>
        <button type="button" class="secondary-btn" id="import-btn">
          <span class="icon icon--import" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <circle class="icon-accent" cx="12" cy="12" r="10"></circle>
              <path d="M12 5v9"></path>
              <polyline points="8.5 10.5 12 14 15.5 10.5"></polyline>
              <path d="M6.5 16.5H17.5a1.5 1.5 0 001.5-1.5V13"></path>
            </svg>
          </span>
          <span class="label-text">Importer un Markdown</span>
        </button>
        <button type="button" class="ghost-btn" id="backoffice-btn">
          <span class="icon icon--backoffice" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <circle class="icon-accent" cx="12" cy="12" r="10"></circle>
              <path d="M8 8.5h9.5"></path>
              <path d="M8 12h6.5"></path>
              <path d="M8 15.5h10"></path>
              <circle class="icon-dot" cx="6" cy="8.5" r="1"></circle>
              <circle class="icon-dot" cx="6" cy="12" r="1"></circle>
              <circle class="icon-dot" cx="6" cy="15.5" r="1"></circle>
            </svg>
          </span>
          <span class="label-text">Gérer le backoffice</span>
        </button>
        <button type="button" class="ghost-btn" id="glossary-btn">
          <span class="icon icon--glossary" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <circle class="icon-accent" cx="12" cy="12" r="10"></circle>
              <path d="M11.8 7.5h-3a2 2 0 00-2 2v10.5a2 2 0 012-2h3"></path>
              <path d="M12.2 7.5h3a2 2 0 012 2v10.5a2 2 0 00-2-2h-3"></path>
              <path d="M12 9.5v8.5"></path>
            </svg>
          </span>
          <span class="label-text">Consulter les acronymes</span>
        </button>
        <button type="button" class="new-procedure-btn" id="new-procedure-btn">
          <span class="icon icon--new" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <circle class="icon-accent" cx="12" cy="12" r="10"></circle>
              <path d="M12 7.5v9"></path>
              <path d="M7.5 12h9"></path>
            </svg>
          </span>
          <span class="label-text">Nouvelle procédure</span>
        </button>
      </div>
    </header>
    <div class="layout">
      <div class="content">
        <section class="card info-card" id="start-info">
          <h2 id="start-info-title">
            <span class="icon icon--info" aria-hidden="true">
              <svg viewBox="0 0 24 24">
                <circle class="icon-accent" cx="12" cy="12" r="10"></circle>
                <circle class="icon-dot" cx="12" cy="8.25" r="1"></circle>
                <path d="M12 11v5.5"></path>
                <path d="M11.25 16.5h1.5"></path>
              </svg>
            </span>
            <span class="label-text">Démarrer une nouvelle procédure</span>
          </h2>
          <p id="start-info-description">
            Pour créer un nouveau document, cliquez sur le bouton « Nouvelle procédure » situé dans l'entête.
            Un canevas vierge sera automatiquement préparé pour vous permettre de renseigner chaque section.
          </p>
          <ul id="start-info-list">
            <li>Complétez les métadonnées pour contextualiser la procédure.</li>
            <li>Rédigez le contenu opérationnel à l'aide de l'éditeur enrichi.</li>
            <li>Finalisez par la session de Questions &amp; Réponses avant l'export.</li>
          </ul>
        </section>
        <section class="card" id="metadata-card">
          <h2 id="metadata-card-title">
            <span class="icon icon--metadata" aria-hidden="true">
              <svg viewBox="0 0 24 24">
                <rect x="6.5" y="8" width="11" height="9.5" rx="2"></rect>
                <path d="M6.5 10.75h11"></path>
                <path d="M9 6.75h3l1 1h4.5"></path>
                <path d="M9 13.5h5"></path>
              </svg>
            </span>
            <span class="label-text">1. Métadonnées</span>
          </h2>
          <div class="metadata-grid" id="metadata-groups"></div>
        </section>
        <div class="editor-insights">
          <section class="card editor-card" id="editor-card">
            <h2 id="editor-card-title">
              <span class="icon icon--editor" aria-hidden="true">
                <svg viewBox="0 0 24 24">
                  <circle class="icon-accent" cx="12" cy="12" r="10"></circle>
                  <path d="M9 15.5l7-7"></path>
                  <path d="M14.75 6.75l2.5 2.5"></path>
                  <path d="M8.5 16.5h3.75"></path>
                </svg>
              </span>
              <span class="label-text">2. Contenu de la procédure</span>
            </h2>
            <div class="toolbar" id="editor-toolbar">
              <button type="button" data-command="formatBlock" data-value="H1">H1</button>
              <button type="button" data-command="formatBlock" data-value="H2">H2</button>
              <button type="button" data-command="formatBlock" data-value="H3">H3</button>
              <button type="button" data-command="formatBlock" data-value="H4">H4</button>
              <button type="button" data-command="bold">Gras</button>
              <button type="button" data-command="italic">Italique</button>
              <button type="button" id="insert-rational-btn">Rationnel</button>
              <button type="button" data-command="insertUnorderedList">Liste à puces</button>
              <button type="button" data-command="insertOrderedList">Liste numérotée</button>
            </div>
            <div class="editor-layout">
              <div class="editor-pane">
                <div class="editor" id="procedure-editor" contenteditable="true" aria-label="Zone d'édition du contenu"></div>
                <div class="editor-guideline-layer" id="editor-guideline-layer" aria-hidden="true"></div>
              </div>
            </div>
          </section>
          <aside class="insights">
            <div class="insight-card inline-guidelines" aria-labelledby="guidelines-title">
            <h3 id="guidelines-title">
              <span class="icon icon--guidelines" aria-hidden="true">
                <svg viewBox="0 0 24 24">
                  <circle class="icon-accent" cx="12" cy="12" r="10"></circle>
                  <path d="M12 7.2l1.6 3.2 3.5.3-2.7 2.3.8 3.5-3.2-1.7-3.2 1.7.8-3.5-2.7-2.3 3.5-.3z"></path>
                </svg>
              </span>
              <span class="label-text">Guidelines IA Friendly</span>
            </h3>
            <p id="guidelines-empty">Commencez votre rédaction pour recevoir des recommandations.</p>
            <button type="button" class="guideline-hidden-toggle" id="guidelines-hidden-toggle" hidden>
              Afficher les recommandations masquées
            </button>
            <ul class="guideline-comment-list" id="guidelines-list"></ul>
          </div>
        </aside>
        </div>
        <section class="card" id="qa-card">
          <h2 id="qa-card-title">
            <span class="icon icon--qa" aria-hidden="true">
              <svg viewBox="0 0 24 24">
                <circle class="icon-accent" cx="12" cy="12" r="10"></circle>
                <path d="M7.5 8.5h9a2 2 0 012 2v2.5a2 2 0 01-2 2H13l-2 2v-2H7.5a2 2 0 01-2-2v-2.5a2 2 0 012-2z"></path>
              </svg>
            </span>
            <span class="label-text">3. Questions &amp; Réponses</span>
          </h2>
          <p id="qa-card-description" style="color: var(--muted); font-size: 14px; margin-top: 0;">
            Structurez la session de questions-réponses qui conclura la procédure.
          </p>
          <div class="qa-list" id="qa-list" style="display: flex; flex-direction: column; gap: 16px;"></div>
          <div class="export-actions" style="justify-content: flex-start; margin-top: 16px;">
            <button type="button" class="secondary-btn" id="add-qa-btn">
              <span class="icon icon--qa" aria-hidden="true">
                <svg viewBox="0 0 24 24">
                  <circle class="icon-accent" cx="12" cy="12" r="10"></circle>
                  <path d="M12 7.5v9"></path>
                  <path d="M7.5 12h9"></path>
                </svg>
              </span>
              <span class="label-text">Ajouter une question</span>
            </button>
          </div>
        </section>
        <section class="card" id="export-card">
          <h2 id="export-card-title">
            <span class="icon icon--export" aria-hidden="true">
              <svg viewBox="0 0 24 24">
                <circle class="icon-accent" cx="12" cy="12" r="10"></circle>
                <rect x="6.5" y="9" width="11" height="8.5" rx="2"></rect>
                <path d="M12 6.5V14"></path>
                <polyline points="8.75 10.5 12 7.25 15.25 10.5"></polyline>
              </svg>
            </span>
            <span class="label-text">Aperçu &amp; Export</span>
          </h2>
          <div class="warning" id="blocking-warning" hidden>
            <span id="blocking-warning-text">⚠️ Export impossible tant que les points suivants ne sont pas corrigés :</span>
            <ul class="insight-list" id="blocking-warning-list"></ul>
          </div>
          <div class="export-actions">
            <button type="button" class="secondary-btn" id="preview-btn">
              <span class="icon icon--preview" aria-hidden="true">
                <svg viewBox="0 0 24 24">
                  <path d="M3.5 12c2.3-3.7 5.2-5.5 8.5-5.5s6.2 1.8 8.5 5.5c-2.3 3.7-5.2 5.5-8.5 5.5s-6.2-1.8-8.5-5.5z"></path>
                  <circle class="icon-dot" cx="12" cy="12" r="2"></circle>
                  <circle cx="12" cy="12" r="4.5"></circle>
                </svg>
              </span>
              <span class="label-text">Prévisualiser le Markdown</span>
            </button>
            <button type="button" class="primary-btn" id="export-md-btn">
              <span class="icon icon--markdown" aria-hidden="true">
                <svg viewBox="0 0 24 24">
                  <circle class="icon-accent" cx="12" cy="12" r="10"></circle>
                  <path d="M7 8.5h10a1.5 1.5 0 011.5 1.5v6a1.5 1.5 0 01-1.5 1.5H7A1.5 1.5 0 015.5 16V10a1.5 1.5 0 011.5-1.5z"></path>
                  <path d="M12 6.5v7"></path>
                  <polyline points="9 12 12 15 15 12"></polyline>
                </svg>
              </span>
              <span class="label-text">Exporter en Markdown</span>
            </button>
            <button type="button" class="primary-btn" id="export-pdf-btn">
              <span class="icon icon--pdf" aria-hidden="true">
                <svg viewBox="0 0 24 24">
                  <circle class="icon-accent" cx="12" cy="12" r="10"></circle>
                  <path d="M9 6.5h4.5l3 3V17a2 2 0 01-2 2H9a2 2 0 01-2-2V8.5a2 2 0 012-2z"></path>
                  <path d="M13.5 6.5V9h2.5"></path>
                  <path d="M9.5 12.75h5"></path>
                  <path d="M9.5 15.25h5"></path>
                </svg>
              </span>
              <span class="label-text">Exporter en PDF</span>
            </button>
          </div>
        </section>
      </div>
    </div>
  </div>
  <footer id="app-version">Version 1.2.14</footer>
  <div class="preview-modal" id="preview-modal" role="dialog" aria-modal="true" aria-labelledby="preview-title" hidden>
    <div class="preview-content">
      <div class="preview-header">
        <h3 id="preview-title" style="margin: 0; display: flex; align-items: center; gap: 8px;">
          <span class="icon icon--preview" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <path d="M3.5 12c2.3-3.7 5.2-5.5 8.5-5.5s6.2 1.8 8.5 5.5c-2.3 3.7-5.2 5.5-8.5 5.5s-6.2-1.8-8.5-5.5z"></path>
              <circle class="icon-dot" cx="12" cy="12" r="2"></circle>
              <circle cx="12" cy="12" r="4.5"></circle>
            </svg>
          </span>
          <span class="label-text">Aperçu Markdown</span>
        </h3>
        <button type="button" class="secondary-btn" id="close-preview-btn">Fermer</button>
      </div>
      <div class="preview-body">
        <pre id="preview-body"></pre>
      </div>
    </div>
  </div>
  <div class="backoffice-overlay" id="backoffice-overlay" role="dialog" aria-modal="true" aria-labelledby="backoffice-title" hidden>
    <div class="backoffice-panel" role="document" tabindex="-1">
      <div class="backoffice-panel-header">
        <h2 id="backoffice-title">
          <span class="icon icon--backoffice" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <circle class="icon-accent" cx="12" cy="12" r="10"></circle>
              <path d="M8 8.5h9.5"></path>
              <path d="M8 12h6.5"></path>
              <path d="M8 15.5h10"></path>
              <circle class="icon-dot" cx="6" cy="8.5" r="1"></circle>
              <circle class="icon-dot" cx="6" cy="12" r="1"></circle>
              <circle class="icon-dot" cx="6" cy="15.5" r="1"></circle>
            </svg>
          </span>
          <span class="label-text">Backoffice — Options des champs</span>
        </h2>
        <button type="button" class="secondary-btn" id="close-backoffice-btn">Fermer</button>
      </div>
      <p class="backoffice-description">
        Personnalisez les listes de choix proposées dans les menus déroulants du formulaire.
      </p>
      <div id="backoffice-sections"></div>
      <div class="export-actions backoffice-actions">
        <button type="button" class="secondary-btn" id="export-config-btn">
          <span class="icon icon--config" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <circle class="icon-accent" cx="12" cy="12" r="10"></circle>
              <rect x="6.5" y="7.5" width="11" height="11" rx="2"></rect>
              <path d="M8.5 12.5h7"></path>
              <polyline points="12 9.5 15.5 12.5 12 15.5"></polyline>
            </svg>
          </span>
          <span class="label-text">Exporter la configuration JSON</span>
        </button>
      </div>
    </div>
  </div>
  <div class="glossary-overlay" id="glossary-overlay" role="dialog" aria-modal="true" aria-labelledby="glossary-title" hidden>
    <div class="glossary-panel" role="document" tabindex="-1">
      <div class="glossary-panel-header">
        <h2 id="glossary-title">
          <span class="icon icon--glossary" aria-hidden="true">
            <svg viewBox="0 0 24 24">
              <circle class="icon-accent" cx="12" cy="12" r="10"></circle>
              <path d="M11.8 7.5h-3a2 2 0 00-2 2v10.5a2 2 0 012-2h3"></path>
              <path d="M12.2 7.5h3a2 2 0 012 2v10.5a2 2 0 00-2-2h-3"></path>
              <path d="M12 9.5v8.5"></path>
            </svg>
          </span>
          <span class="label-text">Liste des acronymes</span>
        </h2>
        <button type="button" class="secondary-btn" id="close-glossary-btn">Fermer</button>
      </div>
      <p class="glossary-description" id="glossary-description">
        Consultez la base des acronymes partagés pour assurer une terminologie cohérente.
      </p>
      <p id="glossary-loading" style="color: var(--muted); margin: 0;">Chargement de la liste des acronymes…</p>
      <p class="warning" id="glossary-error" hidden></p>
      <ul class="glossary-list" id="glossary-list"></ul>
    </div>
  </div>
  <input type="file" id="import-input" accept=".md,.markdown,text/markdown" hidden />
  <script src="./assets/vendor/react/react-pdf-lite.js"></script>
  <script type="module" src="./app.js"></script>
</body>
</html>
